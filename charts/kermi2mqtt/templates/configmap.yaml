apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kermi2mqtt.configMapName" . }}
  labels:
    {{- include "kermi2mqtt.labels" . | nindent 4 }}
data:
  config.yaml: |
    # Kermi2mqtt configuration
    # Generated by Helm chart

    log_level: {{ .Values.config.logLevel | quote }}

    modbus:
      host: {{ .Values.config.modbus.host | quote }}
      port: {{ .Values.config.modbus.port }}
      mode: {{ .Values.config.modbus.mode | quote }}

    mqtt:
      host: {{ .Values.config.mqtt.host | quote }}
      port: {{ .Values.config.mqtt.port }}
      tls_enabled: {{ .Values.config.mqtt.tlsEnabled }}
      tls_insecure: {{ .Values.config.mqtt.tlsInsecure }}
      # Credentials loaded from environment variables
      username: ${MQTT_USERNAME}
      password: ${MQTT_PASSWORD}
      client_id_prefix: {{ .Values.config.mqtt.clientIdPrefix | quote }}
      base_topic: {{ .Values.config.mqtt.baseTopic | quote }}

    home_assistant:
      discovery_enabled: {{ .Values.config.homeAssistant.discoveryEnabled }}
      discovery_prefix: {{ .Values.config.homeAssistant.discoveryPrefix | quote }}

    polling_interval: {{ .Values.config.pollingInterval }}
