apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "kermi2mqtt.configMapName" . }}
  labels:
    {{- include "kermi2mqtt.labels" . | nindent 4 }}
data:
  config.yaml: |
    # Kermi2mqtt configuration
    # Generated by Helm chart

    {{- if eq .Values.config.integration.connectionType "http" }}
    http:
      host: {{ .Values.config.http.host | quote }}
      port: {{ .Values.config.http.port }}
      {{- if .Values.config.http.password }}
      password: {{ .Values.config.http.password | quote }}
      {{- end }}
      timeout: {{ .Values.config.http.timeout }}
    {{- else }}
    modbus:
      host: {{ .Values.config.modbus.host | quote }}
      port: {{ .Values.config.modbus.port }}
      mode: {{ .Values.config.modbus.mode | quote }}
    {{- end }}

    mqtt:
      host: {{ .Values.config.mqtt.host | quote }}
      port: {{ .Values.config.mqtt.port }}
      tls_enabled: {{ .Values.config.mqtt.tlsEnabled }}
      tls_insecure: {{ .Values.config.mqtt.tlsInsecure }}
      # Credentials loaded from MQTT_USERNAME/MQTT_PASSWORD environment variables

    integration:
      connection_type: {{ .Values.config.integration.connectionType | quote }}
      {{- if .Values.config.integration.deviceId }}
      device_id: {{ .Values.config.integration.deviceId | quote }}
      {{- end }}
      base_topic: {{ .Values.config.mqtt.baseTopic | quote }}
      poll_interval: {{ .Values.config.pollingInterval }}
      ha_discovery_enabled: {{ .Values.config.homeAssistant.discoveryEnabled }}
      ha_discovery_prefix: {{ .Values.config.homeAssistant.discoveryPrefix | quote }}

    logging:
      level: {{ .Values.config.logLevel | quote }}
